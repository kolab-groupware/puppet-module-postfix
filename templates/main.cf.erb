# Managed by Puppet

queue_directory = /var/spool/postfix
command_directory = /usr/sbin
daemon_directory = /usr/libexec/postfix
mail_owner = postfix
default_privs = nobody
inet_interfaces = all
mynetworks = 127.0.0.0/8
mynetworks_style = host

smtpd_tls_cert_file = /etc/pki/tls/private/mykolab.com.pem
smtpd_tls_CAfile = /etc/pki/tls/certs/mykolab.com.ca.cert
smtpd_tls_auth_only = yes

disable_vrfy_command = yes
smtpd_helo_required = yes

debug_peer_level = 2
sendmail_path = /usr/sbin/sendmail.postfix
newaliases_path = /usr/bin/newaliases.postfix
mailq_path = /usr/bin/mailq.postfix
setgid_group = postdrop

recipient_delimiter = +

relayhost = [smtp.kolabsys.net]

<% hosteddomains = scope.function_titles_for_restype_in_environment([environment, 'Mykolab-kolab::Hosteddomain']) -%>

mydestination =
    <% hosteddomains.each do |hosteddomain| -%>
    ldap:/etc/postfix/ldap/<%= hosteddomain -%>/mydestination.cf,
    <% end -%>
    ldap:/etc/postfix/ldap/hosted_triplet_mydestination.cf,
    ldap:/etc/postfix/ldap/hosted_duplet_mydestination.cf

local_recipient_maps =
    <% hosteddomains.each do |hosteddomain| -%>
    ldap:/etc/postfix/ldap/<%= hosteddomain -%>/local_recipient_maps.cf,
    <% end -%>
    ldap:/etc/postfix/ldap/hosted_triplet_local_recipient_maps.cf,
    ldap:/etc/postfix/ldap/hosted_duplet_local_recipient_maps.cf

virtual_alias_maps = $alias_maps,
    <% hosteddomains.each do |hosteddomain| -%>
    ldap:/etc/postfix/ldap/<%= hosteddomain -%>/virtual_alias_maps.cf,
    <% end -%>
    ldap:/etc/postfix/ldap/hosted_triplet_virtual_alias_maps.cf,
    ldap:/etc/postfix/ldap/hosted_duplet_virtual_alias_maps.cf,
    <% hosteddomains.each do |hosteddomain| -%>
    ldap:/etc/postfix/ldap/<%= hosteddomain -%>/virtual_alias_maps_mailforwarding.cf,
    <% end -%>
    ldap:/etc/postfix/ldap/hosted_triplet_virtual_alias_maps_mailforwarding.cf,
    ldap:/etc/postfix/ldap/hosted_duplet_virtual_alias_maps_mailforwarding.cf,
    <% hosteddomains.each do |hosteddomain| -%>
    ldap:/etc/postfix/ldap/<%= hosteddomain -%>/virtual_alias_maps_sharedfolders.cf,
    <% end -%>
    ldap:/etc/postfix/ldap/hosted_triplet_virtual_alias_maps_sharedfolders.cf,
    ldap:/etc/postfix/ldap/hosted_duplet_virtual_alias_maps_sharedfolders.cf,
    <% hosteddomains.each do |hosteddomain| -%>
    ldap:/etc/postfix/ldap/<%= hosteddomain -%>/mailenabled_distgroups.cf,
    <% end -%>
    ldap:/etc/postfix/ldap/hosted_triplet_mailenabled_distgroups.cf,
    ldap:/etc/postfix/ldap/hosted_duplet_mailenabled_distgroups.cf,
    <% hosteddomains.each do |hosteddomain| -%>
    ldap:/etc/postfix/ldap/<%= hosteddomain -%>/mailenabled_dynamic_distgroups.cf,
    <% end -%>
    ldap:/etc/postfix/ldap/hosted_triplet_mailenabled_dynamic_distgroups.cf,
    ldap:/etc/postfix/ldap/hosted_duplet_mailenabled_dynamic_distgroups.cf,
    <% hosteddomains.each do |hosteddomain| -%>
    ldap:/etc/postfix/ldap/<%= hosteddomain -%>/virtual_alias_maps_catchall.cf,
    <% end -%>
    ldap:/etc/postfix/ldap/hosted_triplet_virtual_alias_maps_catchall.cf,
    ldap:/etc/postfix/ldap/hosted_duplet_virtual_alias_maps_catchall.cf

transport_maps =
    <% hosteddomains.each do |hosteddomain| -%>
    ldap:/etc/postfix/ldap/<%= hosteddomain -%>/transport_maps.cf,
    <% end -%>
    ldap:/etc/postfix/ldap/adomaiciai.org/transport_maps.cf,
    ldap:/etc/postfix/ldap/hosted_triplet_transport_maps.cf,
    ldap:/etc/postfix/ldap/hosted_duplet_transport_maps.cf,
    hash:/etc/postfix/transport

local_transport = relay:[smtp.kolabsys.net]:25

message_size_limit = 26214400
